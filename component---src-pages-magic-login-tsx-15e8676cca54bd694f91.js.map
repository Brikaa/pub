{"version":3,"sources":["webpack:///./src/pages/magic-login.tsx"],"names":["MagicLoginPage","useState","message","setMessage","siteMetadata","useSiteMetadata","token","location","URLSearchParams","search","get","setTimeout","a","auth","ServiceResolver","authResolver","signIn","email","password","response","ok","SessionStorageHelper","storeJwt","data","navigate","Fragment","title","description","urlSlug"],"mappings":"6gBAwEeA,UAvDkB,WAAM,MACPC,mBAAiB,iBAAxCC,EAD8B,KACrBC,EADqB,KAE/BC,EAAeC,cA8BrB,OACE,kBAAC,IAAD,KAIE,kBAAC,WAAD,MACG,YAAkB,IAlCJC,EAkCXC,EAAe,EAAfA,SAEF,OApCaD,EAmCD,IAAIE,gBAAgBD,EAASE,QAAQC,IAAI,SAjC3DC,WAAU,YAAC,8BAAAC,EAAA,yDACK,KAAVN,GAA0B,OAAVA,EADX,uBAEPH,EAAW,wBAFJ,iCAKHU,EAAOC,IAAgBC,eALpB,kBAQiBF,EAAKG,OAAO,CAClCC,MAAO,QACPC,SAAUZ,IAVL,QAQDa,EARC,QAaMC,IACXC,IAAqBC,SAASH,EAASI,MACvCC,mBAAS,mBAETrB,EAAYgB,EAASI,KAAuBrB,SAjBvC,kDAqBPC,EAAW,uBArBJ,0DAuBR,KAWU,kBAAC,IAAMsB,SAAP,SAGX,kBAAC,IAAD,CACEC,MAAUtB,EAAasB,MAAlB,gBACLC,YAAW,oBAAsBvB,EAAasB,MAAnC,WACXE,QAAQ,aAEV,kBAAC,IAAD,KACE,kBAAC,IAAD,KAAY1B,GACZ,kBAAC,IAAD","file":"component---src-pages-magic-login-tsx-15e8676cca54bd694f91.js","sourcesContent":["import React, { useState } from 'react';\nimport { navigate } from 'gatsby';\nimport {\n  Container,\n  Layout,\n  PageTitle,\n  PageBody,\n  Seo,\n} from '@components/shared';\nimport { useSiteMetadata } from '@hooks';\nimport ServiceResolver from '@/api/service-resolver';\nimport { Location } from '@reach/router';\nimport { ApiResponse, ErrorResponse } from '@/api/types/responses';\nimport { JwtToken } from '@/api/types/jwt-token';\nimport { SessionStorageHelper } from '@/helpers';\n\n/** Page allows members to login via magic link method */\nconst MagicLoginPage: React.FC = () => {\n  const [message, setMessage] = useState<string>('Logging in...');\n  const siteMetadata = useSiteMetadata();\n\n  const handleLogin = (token: string | null) => {\n    // Adding 600ms set timeout to allow user to view messages\n    setTimeout(async () => {\n      if (token === '' || token === null) {\n        setMessage('Login token missing.');\n        return;\n      }\n      const auth = ServiceResolver.authResolver();\n\n      try {\n        const response = (await auth.signIn({\n          email: 'token',\n          password: token,\n        })) as ApiResponse<JwtToken | ErrorResponse>;\n\n        if (response.ok) {\n          SessionStorageHelper.storeJwt(response.data as JwtToken);\n          navigate('/app/projects/');\n        } else {\n          setMessage((response.data as ErrorResponse).message);\n        }\n      } catch (err) {\n        // TODO: Log error\n        setMessage('Invalid credentials');\n      }\n    }, 600);\n  };\n\n  return (\n    <Layout>\n      {/* Using location to read token from URL Param\n          and log in member.\n      */}\n      <Location>\n        {({ location }) => {\n          handleLogin(new URLSearchParams(location.search).get('token'));\n          return <React.Fragment />;\n        }}\n      </Location>\n      <Seo\n        title={`${siteMetadata.title} - Contact Us`}\n        description={`Contact page for ${siteMetadata.title} website`}\n        urlSlug=\"contact/\"\n      />\n      <Container>\n        <PageTitle>{message}</PageTitle>\n        <PageBody />\n      </Container>\n    </Layout>\n  );\n};\nexport default MagicLoginPage;\n"],"sourceRoot":""}